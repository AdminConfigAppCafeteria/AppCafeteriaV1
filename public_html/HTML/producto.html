<!-- @format -->

<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Productos</title>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!-- CSS -->
		<link rel="stylesheet" href="./../CSS/productos.css" />
		<link rel="stylesheet" href="./../CSS/bootstrap.min.css" />

		<!-- DataTable -->
		<link rel="stylesheet" type="text/css" href="./../Assets/datatables/datatables.min.css"/>
 		<link rel="stylesheet" type="text/css" href="./../Assets/datatables/DataTables-1.10.18/css/dataTables.bootstrap4.min.css"/>

		<!-- Fontawesome -->
		<script src="https://kit.fontawesome.com/1382257960.js" crossorigin="anonymous"></script>

		<!-- Material Icons -->
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	</head>

	<body>
		<!-- Barra de navegacion -->
		<div class="navbar">
			<div class="navbar-logo">
				<img src="./../Assets/logo2-removebg-preview.png" class="logo" />
				<div class="form-group mx-sm-4 pb-2 boton">
					<a href="http://localhost:3000/logout" style=" background: #FF0000; border-radius: 5px; color: white; display: block; font-weight: bold; padding: 20px; text-align: center; text-decoration: none; width: 200px;"> Logout </a>
				</div>
			</div>

			<div class="navbar-linea"></div>

			<div class="navbar-links">
				<ul>
					<li><a class="navbar-links-activo" href="../HTML/producto.html"> <i class="fa-regular fa-paste"></i> Producto </a></li>
					<li><a href="../HTML/auxiliar.html"> <i class="fa-solid fa-user-large"></i> Auxiliar </a></li>
					<li><a href="../HTML/cajero.html"> <i class="fa-solid fa-user-large"></i> Cajero </a></li>
					<li><a href="../HTML/MFijo.html"> <i class="fa-regular fa-paste"></i> Menu fijo </a></li>
					<li><a href="../HTML/MRotativo.html"> <i class="fa-regular fa-paste"></i> Menu rotativo </a></li>
					<li><a href="../HTML/VerMenu.html"> <i class="fa-solid fa-eye"></i> Visualizar Menu </a></li>
				</ul>
			</div>
		</div>

		<!-- Contenido tabla -->
		<section class="full-box dashboard-contentPage" style="background-color: #024731; padding-top: 10px;">
			<nav class="full-box dashboard-Navbar" style="background-color: #16817A;">
				<ul class="full-box list-unstyled text-right">
					<li class="pull-left">
						<a href="#!" class="btn-menu-dashboard"><i class="zmdi zmdi-more-vert"></i></a>
					</li>
					<li>
						<a href="#!" class="btn-modal-help">
							<i class="zmdi zmdi-help-outline"></i>
						</a>
					</li>
				</ul>
			</nav>

			<div class="container-fluid">
				<div class="row">
					<div class="col-lg-9">
						<button id="add_button" type="button" class="btn " data-toggle="modal" data-target="#userModal"><i class="material-icons">library_add</i></button>
						<a style="color: white; font-size: 2vh; padding-left: 20px;"> Productos </a>
					</div>
				</div>
			</div>
			<div class="container-fluid" style="padding-top: 30px;">
				<div class="container caja" style="background-color: #FEBE10; padding: 40px 70px 10px 70px;">
					<div class="row">
						<div class="col-lg-12">
							<div class="table-responsive">
								<table id="user_data" class="table table-bordered table-striped" style="width:100%; background-color: white;">
									<thead>
										<tr>
											<th width="10%"> Foto </th>
											<th width="20%"> Nombre </th>
											<th width="35%"> Descripcion </th>
											<th width="10%"> Categoria </th>
											<th width="10%"> Precio </th>
											<th width="15%"> Acciones </th>
											<th width="10%"> Visible </th>
										</tr>
									</thead>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- Modal -->
		<div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel"></h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
						</button>
					</div>
	
					<form method="post" id="user_form" enctype="multipart/form-data">
						<div class="modal-body" style="background-color: #b2b9b92a;">
							<div class="row">
								<div class="col-lg-12">
									<div class="form-group">
										<label for="" class="col-form-label">Nombre producto: </label>
										<input type="text" class="form-control" name="first_name" id="first_name" required>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-lg-12">
									<div class="form-group">
										<label for="" class="col-form-label">Descripcion: </label>
										<input type="text" class="form-control" name="last_name" id="last_name" required>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-lg-12">
									<div class="form-group">
										<label for="" class="col-form-label">Categoria: </label>
										<select class="form-control" id="categoria_platillo" name="categoria_platillo">
											<option value="0"> Seleccione una categoria</option>
											<option value="1"> Extras </option>
											<option value="2"> Bebidas </option>
											<option value="3"> Sandwiches </option>
											<option value="4"> Desayunos </option>
											<option value="5"> Burritos </option>
										</select>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-lg-6">
									<div class="form-group">
										<label for="" class="col-form-label">Precio: </label>
										<input type="nomber" class="form-control" name="precio" id="precio" required>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="">
										<label for="" class="col-form-label">Imagen: </label>
										<input type="file" class="" name="user_image" id="user_image" accept="image/x-png, image/gif, image/jpeg" required>
										<span id="user_uploaded_image"></span>
									</div>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<input type="hidden" name="user_id" id="user_id" />
							<input type="hidden" name="operation" id="operation" />
							<button type="button" class="btn btn-light" data-dismiss="modal">Cancelar</button>
							<button type="submit" name="action" id="action" class="btn btn-dark" value="Add">Guardar</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- Scripts -->
		<script src="./../JavaScript/jquery-3.1.1.min.js"></script> <!--  jquery version 3.1.1 -->
		<script src="./../JavaScript/sweetalert2.min.js"></script> <!--  SweetAlert2 para decoracion de las alertas del navegador -->
		<script src="./../JavaScript/bootstrap.min.js"></script> <!--  Bootstrap 4.0 -->
		<script src="./../JavaScript/material.min.js"></script> <!--  Material Design Bootstrap -->
		<script src="./../JavaScript/ripples.min.js"></script> <!--  Ripples, efectos para los botones -->
		<script src="./../JavaScript/jquery.mCustomScrollbar.concat.min.js"></script> <!--  Scrollbar -->
		<script src="./../JavaScript/main.js"></script> <!--  Script principal -->
		<script src="./../Assets/popper/popper.min.js"></script> <!--  Scripts de popper -->
		<script type="text/JavaScript" src="./../Assets/datatables/datatables.min.js"></script> <!--  Scripts de datatables --> 

		<script type="text/javascript" language="javascript">
			$(document).ready(function(){
				$('#add_button').click(function(){
					$('#user_form')[0].reset();
					$('.modal-title').text("Nuevo producto");
					$('#action').val("Add");
					$('#operation').val("Add");
					$('#user_uploaded_image').html('');
				});
				
				var dataTable = $('#user_data').DataTable({
					"processing":true,
					"serverSide":true,
					"order":[],
					"ajax":{
						url:"./../api/fetch.php",
						type:"POST"
					},
					"columnDefs":[
						{
							"targets":[0, 5, 6],
							"orderable":false,
						},
					],
			
				});
			
				$(document).on('submit', '#user_form', function(event){
					event.preventDefault();
			
					$('#user_image').prop('required',true);
			
					var firstName = $('#first_name').val();
					var precio = $('#precio').val();
					var extension = $('#user_image').val().split('.').pop().toLowerCase();
					if(extension != '')
					{
						if(jQuery.inArray(extension, ['gif','png','jpg','jpeg']) == -1)
						{
							alert("Tipo de imagen invalida, solo .gif, .png, .jpg y .jpeg");
							$('#user_image').val('');
							return false;
						}
					}	
					if(firstName != '' && precio != '' && categoria_platillo != 0) {
			
						if($('#action').val() == "Add") {
							if (confirm("¿Estas seguro de agregar este producto?")) {
								$.ajax({
									url:"./../api/insert.php",
									method:'POST',
									data:new FormData(this),
									contentType:false,
									processData:false,
									success:function(data)
									{
										alert(data);
										$('#user_form')[0].reset();
										$('#userModal').modal('hide');
										dataTable.ajax.reload();
									}
								});
							}
						}
			
						if($('#action').val() == "Edit") {
							if (confirm("¿Estas seguro de editar este producto?")) {
								$.ajax({
									url:"./../api/insert.php",
									method:'POST',
									data:new FormData(this),
									contentType:false,
									processData:false,
									success:function(data)
									{
										alert(data);
										$('#user_form')[0].reset();
										$('#userModal').modal('hide');
										dataTable.ajax.reload();
									}
								});
							}
						}
					}
					else
					{
						alert("Precio, Nombre y Categoria obligatorios");
					}
				});
				
				$(document).on('click', '.update', function(){
					var user_id = $(this).attr("id");
					$('#user_image').prop('required',false);
			
					$.ajax({
						url:"./../api/fetch_single.php",
						method:"POST",
						data:{user_id:user_id},
						dataType:"json",
						success:function(data)
						{
							//console.log(data);
							$('#userModal').modal('show');
							$('#first_name').val(data.first_name);
							$('#last_name').val(data.last_name);
							$('#precio').val(data.precio);
							$('#categoria_platillo').val(data.categoria_platillo);
							$('.modal-title').text("Editar producto");
							$('#user_id').val(user_id);
							$('#user_uploaded_image').html(data.user_image);
							$('#action').val("Edit");
							$('#operation').val("Edit");
						}
					})
				});
				
				$(document).on('click', '.delete', function(){
					var user_id = $(this).attr("id");
					if(confirm("¿Seguro que desea eliminar este producto?"))
					{
						$.ajax({
							url:"./../api/delete.php",
							method:"POST",
							data:{user_id:user_id},
							success:function(data)
							{
								alert(data);
								dataTable.ajax.reload();
							}
						});
					}
					else
					{
						return false;	
					}
				});	
			});

			function mostrar(id_platillo) {
				console.log("mostrar");
				console.log(id_platillo);
	
				$.ajax({
					method: "POST",
					url: "./../api/mostrar.php",
					data: {
						id_platillo: id_platillo
					},
	
					success: function(data) {
						location.reload();
					}
				});
			}
	
			function ocultar(id_platillo) {
				console.log("ocultar");
				console.log(id_platillo);
	
				$.ajax({
					method: "POST",
					url: "./../api/ocultar.php",
					data: {
						id_platillo: id_platillo
					},
	
					success: function(data) {
						location.reload();
					}
				});
			}
		</script>
		

	</body>
</html>
